---
title: "Sensor-guided Side-dressing Decision Making"
date: "`r Sys.Date()`" 
author:
  - Taro Mieno^[University of Nebraska Lincoln, tmieno2@unl.edu] and John Doe^[Random University, johndoe@email.com]
abstract: "Abstract: this research is so awesome that you cannot reject this paper."
output:
  officedown::rdocx_document:
    toc: false
    toc_depth: 1
    number_sections: true
    reference_docx: "word_template.docx"
    base_format: "bookdown::word_document2" # for equation numbering
    plots:
      style: Normal
      align: center
      caption:
       style: Image Caption
       pre: "Figure "
       sep: ": "
    tables:
      style: Table
      layout: autofit
      width: 1.0
      caption:
       style: Table Caption
       pre: "Table "
       sep: ": "
bibliography: bibliography.bib
csl: agronomy.csl
# eqnPrefix:
#   - "Equation"
---

```{r include = F}
library(knitr)
library(officedown)
library(officer)

opts_knit$set(root.dir = "/Users/tmieno2/Dropbox/TeachingUNL/DataScience/LectureNotes/Chapter-9-WritingArticle")

options(htmltools.dir.version = FALSE)
options(knitr.duplicate.label = "allow")

opts_chunk$set(
  fig.align = "center",
  fig.retina = 5,
  warning = F,
  message = F,
  cache = T,
  echo = F
)
```

```{r eval = F}
# This is for you to set working directory easily. This serves no purpose in knitting to a manuscript
setwd("/Users/tmieno2/Dropbox/TeachingUNL/DataScience/LectureNotes/Chapter-9-WritingArticle")
```

```{r packages}
library(sf)
library(RColorBrewer)
library(patchwork)
library(viridis)
library(ggthemes)
library(flextable)
library(officer)
library(modelsummary)
library(tidyverse)
```

```{r data-preparation}
#--- read the regression data ---#
reg_data <- readRDS("reg_data.rds") %>%
  .[, Zone := case_when(
    tgt_comb == "36-124" ~ "Zone 3",
    tgt_comb == "34-134" ~ "Zone 2",
  )] %>%
  filter(!is.na(Zone))
```

# Introduction 

The issue this article addresses is **super** _important_!
 
@adrian2005producers examined bluh bluh.

bluh bluh [@shrader1966estimation] 

bluh bluh [@shrader1966estimation; @adrian2005producers] 

bluh bluh [-@shrader1966estimation] 


<!-- page break -->
`r run_pagebreak()` 

# Materials and Methods

This line break does not work:
<br>
See?

This line break does work:

<br>

See?

## Data

```{r summary_statistics}
#--- number of observations by zone ---#
num_obs <- reg_data %>%
  group_by(Zone) %>%
  summarize(n = n())

num_obs_z2 <- filter(num_obs, Zone == "Zone 2")$n
num_obs_z3 <- filter(num_obs, Zone == "Zone 3")$n
```

The number of observations are `r num_obs_z2` and `r num_obs_z3` for Zones 2 and 3, respectively. 

Table \@ref(tab:table-1) presents summary statistics by zone.

## Statistical Model

See equation \@ref(eq:eqn1) for the statistical model we use.

\begin{equation}
y = \beta_0 + \beta_1 x + \varepsilon
(\#eq:eqn1)
\end{equation}


\begin{align}
 Y_z & = f_z(S) + g_z(N) + h_z(X,Y) + \varepsilon_z \\
& = \sum_{i=1}^k \phi_k(S) + g_z(N) + h_z(X,Y) + \varepsilon_z
(\#eq:eqn2)
\end{align}

\@ref(eq:eqn2)

# Results and Discussions

Table \@ref(tab:table-1) presents the regression results.

Figure \@ref(fig:fig-1) presents the distribution of yields by zone.

# Conclusions

bluh blu^[This is a footnote]

# Figures 

```{r fig.id = "fig-1", fig.cap = "The Distribution of Yield by Zone"}
ggplot() +
  geom_density(
    data = reg_data,
    aes(
      x = Yield,
      fill = Zone,
      alpha = 0.3
    )
  )
```

# Tables

```{r table-1, tab.cap = "Summary Statistics by Zone"}

#--- find observations ---#
# write the function that forces the number of observations to be presented as integers
get_N <- function(x) {
  length(x) %>% as.integer()
}

#--- create a summary table by zone ---#
summary_table <- reg_data %>%
  datasummary(
    Zone * (
      (`Yield (kg/ha)` <- Yield) +
        (`Nitrogen Rate (kg/ha)` <- aa_n) +
        (`Seed Rate (1000/ha)` <- aa_s)
    ) ~
      Format(digits = 1) * get_N + Mean + SD + Min + Max,
    data = .,
    output = "flextable"
  ) %>%
  autofit() %>%
  hline(
    i = 3,
    border = fp_border(width = 1)
  )

summary_table
```


# References

<div id="refs"></div>

