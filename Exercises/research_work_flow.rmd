---
output:
  html_document:
    code_folding: "hide"
---

# Exercise: Research Workflow with mtcars Dataset

---

## Objective 1: Load the mtcars dataset 
Students will load the `mtcars` dataset from the `datasets` package.

**Required Functions:** 
- `data()`

**Solution Code 1:**
```{r}
data("mtcars")
head(mtcars)
```

---

## Objective 2: Data Transformation/Reshaping
**2.1:** Add a new column to the dataset called "efficiency" which is computed as miles per gallon (`mpg`) divided by horsepower (`hp`).

**2.2:** Filter the dataset to only retain rows where the number of cylinders (`cyl`) is 4.

**Required Functions:** 
- `mutate()` from the `dplyr` package for creating the new variable.
- `filter()` from the `dplyr` package for filtering the data.

**Solution Code 2:**
```{r}
library(dplyr)

# 2.1
mtcars <- mtcars %>%
  mutate(efficiency = mpg/hp)

# 2.2
filtered_mtcars <- mtcars %>%
  filter(cyl == 4)

head(filtered_mtcars)
```

---

## Objective 3: Data Visualization
**3.1:** Create a scatter plot of horsepower (`hp`) on the x-axis and miles per gallon (`mpg`) on the y-axis, where each point represents a car. Color the points by the number of cylinders (`cyl`). 

**3.2:** On the same plot, facet by the transmission type (`am`, where 0 = automatic and 1 = manual).

**Required Functions:** 
- `ggplot()`, `aes()`, `geom_point()`, and `facet_wrap()` from the `ggplot2` package.

**Solution Code 3:**
```{r}
library(ggplot2)

# 3.1 & 3.2
plot <- ggplot(filtered_mtcars, aes(x=hp, y=mpg, color=factor(cyl))) +
  geom_point() +
  facet_wrap(~am) +
  labs(title="Horsepower vs. Miles Per Gallon",
       x="Horsepower",
       y="Miles per Gallon",
       color="Number of Cylinders")

print(plot)
```

---

# Exercise: Research Workflow with flights Dataset

---

## Objective 1: Load the flights dataset 
Load the `flights` dataset from the `nycflights13` package.

**Required Functions:** 
- `library()`

**Solution Code 1:**
```{r}
library(nycflights13)
data("flights")
head(flights)
```

---

## Objective 2: Data Transformation/Reshaping
**2.1:** Filter the dataset to only retain rows where the `month` is January.

**2.2:** Compute the average arrival delay (`arr_delay`) for each `carrier`.

**Required Functions:** 
- `filter()` and `group_by()` + `summarise()` from the `dplyr` package.

**Solution Code 2:**
```{r}
library(dplyr)

# 2.1
january_flights <- flights %>%
  filter(month == 1)

# 2.2
carrier_avg_delay <- january_flights %>%
  group_by(carrier) %>%
  summarise(avg_arr_delay = mean(arr_delay, na.rm = TRUE))

print(carrier_avg_delay)
```

---

## Objective 3: Data Visualization
Create a bar plot of different carriers on the x-axis and their corresponding average arrival delay on the y-axis.

**Required Functions:** 
- `ggplot()`, `aes()`, `geom_bar()`, and `labs()` from the `ggplot2` package.

**Solution Code 3:**
```{r}
library(ggplot2)

plot <- ggplot(carrier_avg_delay, aes(x = carrier, y = avg_arr_delay)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Average Arrival Delay by Carrier in January",
       x = "Carrier",
       y = "Average Arrival Delay (minutes)")

print(plot)
```

---

## Objective 4: Regression Analysis
Run a basic regression analysis to determine the relationship between distance (`distance`) and arrival delay (`arr_delay`), controlling for `air_time`.

**Required Functions:** 
- `feols()` from the `fixest` package.

**Solution Code 4:**
```{r}
library(fixest)

# Remove NA values for regression analysis
january_flights_clean <- january_flights %>%
  filter(!is.na(arr_delay) & !is.na(distance) & !is.na(air_time))

# Run regression
regression_result <- feols(arr_delay ~ distance + air_time, data = january_flights_clean)

print(regression_result)
```



